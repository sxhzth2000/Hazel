

cmake_minimum_required(VERSION 3.20)

# è®¾ç½®é¡¹ç›®åå’Œè¯­è¨€
project(Hazel LANGUAGES C CXX)

# è®¾ç½® C++ æ ‡å‡†
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)





# æŸ¥æ‰¾æ‰€æœ‰ Hazel ä»£ç æ–‡ä»¶
file(GLOB_RECURSE HAZEL_SOURCES
        src/*.cpp
)
file(GLOB_RECURSE HAZEL_HANDER "src/*.h")
file(GLOB IMGUI_SOURCES
        "vendor/imgui/*.cpp"
        vendor/imgui/backends/imgui_impl_opengl3.cpp
        vendor/imgui/backends/imgui_impl_glfw.cpp
)


# æ„å»º Hazel ä½œä¸ºåŠ¨æ€åº“
add_library(Hazel SHARED
        ${HAZEL_SOURCES}
        ${IMGUI_SOURCES}
        Platform/Windows/WindowsWindow.cpp
        vendor/glad/src/glad.c
        Platform/Windows/WindowsInput.cpp
        src/Hazel/Renderer/GraphicsContext.h
        Platform/OpenGL/OpenGLContext.cpp
        Platform/OpenGL/OpenGLContext.h
        src/Hazel/Renderer/Shader.cpp
        src/Hazel/Renderer/Shader.h
        src/Hazel/Renderer/Buffer.cpp
        src/Hazel/Renderer/Buffer.h
        Platform/OpenGL/OpenglBuffer.cpp
        Platform/OpenGL/OpenglBuffer.h
        src/Hazel/Renderer/Renderer.cpp
        src/Hazel/Renderer/Renderer.h
        src/Hazel/Renderer/VertexArray.cpp
        src/Hazel/Renderer/VertexArray.h
        Platform/OpenGL/OpenGLVertexArray.cpp
        Platform/OpenGL/OpenGLVertexArray.cpp
        Platform/OpenGL/OpenGLVertexArray.h
        src/Hazel/Renderer/RendererAPI.h
        src/Hazel/Renderer/RendererAPI.cpp
        src/Hazel/Renderer/RenderCommand.h
        src/Hazel/Renderer/RenderCommand.cpp
        Platform/OpenGL/OpenGLRendererAPI.cpp
        Platform/OpenGL/OpenGLRendererAPI.h
        src/Hazel/Renderer/OrthographicCamera.cpp
        src/Hazel/Renderer/OrthographicCamera.h
        src/Hazel/Core/TimeStep.h
        src/Hazel/Renderer/OpenglShader.cpp
        src/Hazel/Renderer/OpenglShader.h
        src/Hazel/Renderer/Texture.cpp
        src/Hazel/Renderer/Texture.h
        Platform/OpenGL/OpenGLTexture.cpp
        Platform/OpenGL/OpenGLTexture.h
        vendor/STB_image/stb_image.h
        vendor/STB_image/stb_image.cpp
)

message(STATUS "Hazel sources: ${HAZEL_SOURCES}")


# æ·»åŠ  GLFW æºç ç›®å½•
add_subdirectory(vendor/GLFW)

# é“¾æ¥ GLFWï¼ˆå®ƒæä¾›äº† glfw è¿™ä¸ª targetï¼‰
target_link_libraries(Hazel PRIVATE glfw opengl32)




# å¤´æ–‡ä»¶è·¯å¾„ï¼Œç¡®ä¿ Sandbox å¯ä»¥æ­£ç¡®å¼•ç”¨ Hazel å¤´æ–‡ä»¶
target_include_directories(Hazel PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}/src
    ${CMAKE_CURRENT_SOURCE_DIR}/vendor/spdlog/include
    ${CMAKE_CURRENT_SOURCE_DIR}/vendor/glad/include
    ${CMAKE_CURRENT_SOURCE_DIR}/vendor/imgui/
    ${CMAKE_CURRENT_SOURCE_DIR}/vendor/imgui/backends
    ${CMAKE_CURRENT_SOURCE_DIR}/Platform
    ${CMAKE_SOURCE_DIR}/Hazel/vendor/GLM
    ${CMAKE_SOURCE_DIR}/Hazel/vendor
)

set(CMAKE_PCH_EXTENSION .cpp)  # ğŸ‘ˆ å¼ºåˆ¶ä½¿ç”¨ .cpp ç¼–è¯‘ cmake_pch

# è®¾ç½® PCH ä»…ç”¨äº C++ ç¼–è¯‘å•å…ƒ
target_precompile_headers(Hazel PRIVATE
        $<$<COMPILE_LANGUAGE:CXX>:${CMAKE_CURRENT_SOURCE_DIR}/src/hzpch.h>
)

set_source_files_properties(vendor/glad/src/glad.c PROPERTIES LANGUAGE C)


# Windows ä¸“ç”¨è®¾ç½®
if (WIN32)
    target_compile_definitions(Hazel PUBLIC HZ_PLATFORM_WINDOWS HZ_BUILD_DLL IMGUI_DLL_EXPORTS)
endif()

# MSVC ç¼–è¯‘å™¨è®¾ç½®
#if (MSVC)
#    set(CMAKE_CXX_FLAGS "/utf-8")
#    set(CMAKE_C_FLAGS "/utf-8")
#endif()
if (MSVC)
    # ç”¨äº C++
    target_compile_options(Hazel PRIVATE $<$<COMPILE_LANGUAGE:CXX>:/utf-8>)
    # ç”¨äº C
    target_compile_options(Hazel PRIVATE $<$<COMPILE_LANGUAGE:C>:/utf-8>)
endif()



# è®¾ç½®è¾“å‡ºç›®å½•
set_target_properties(Hazel PROPERTIES
        ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/bin-int  # å¯¼å…¥åº“ (.lib)
        LIBRARY_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/bin-int  # å…±äº«åº“ (.dll)
        RUNTIME_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/bin  # è¿è¡Œåº“ (.dll)
)

